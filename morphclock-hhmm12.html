<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<link rel="stylesheet" href="morphclock.css">
</head>
<body>

<script type='text/javascript' language='javascript' src='morphclock.js'></script>
<script>

window.onload = function() {
    time_format = getTimeFormat();
    img_slot = setImageSlots(time_format);
    console.log(img_slot);
    renderTime();
}


function renderTime() {
    //console.log(img_slots);
    var currentTime = new Date();

    var xh = currentTime.getHours();
    var xm = currentTime.getMinutes();
    var xs = currentTime.getSeconds();
    var xt = currentTime.getMilliseconds();

    var D_ = "ap"; // "d" = day: a.m.
    var _D = "mm"; 
    
    var C_ = "::";
    
    setTimeout('renderTime()',100);
    
    var maxh = time_format.slice(-2);
    if (maxh = 24 ) { maxh = 23; }
    
    maxH_ = Math.floor(maxh/10);
    
    if (xh == 0) { xh = 12; }
    else if (xh > 12) { xh = xh - 12; D_ = "pa"; }

    var H_ = Math.floor(xh/10);
    var _H = xh % 10;
    var M_ = Math.floor(xm/10);
    var _M = xm % 10;
    var S_ = Math.floor(xs/10);
    var _S = xs % 10;
    
    var morphH_ = "00";
    var morph_H = "00";
    var morphM_ = "00";
    var morph_M = "00";
    var morphD_ = "00";
    var morph_D = "00";
    
    // hours part 1
    if (H_ == maxH_) { H_ = H_ + "0"; }
    else if (H_ == 0) { H_ = H_ + "1"; }
    else { H_ = H_ * 10 + (H_ + 1); }
    
    // hours part 2
    if ((xh == maxh) || 
        (_H == 9)) { _H = _H + "0";
                     if (M_ == 5 && _M == 9 && S_ == 5 && _S >= 5) {
                        morphH_ = Math.round(((_S-5)*1000+xt)/50);
                        if (morphH_ < 10) { morphH_ = "0" + morphH_; }
                        if (xh == maxh) {
                           morphD_ = morphH_;
                           morph_D = morphH_;
                        } 
                     }
                   }
    else if (_H == 0) { _H = _H + "1"; }
    else { _H = _H * 10 + (_H + 1); }
    
    // minutes part 1
    if (M_ == 5) { M_ = M_ + "0";
                   if (_M == 9 && S_ == 5 && _S >= 5) {
                      morph_H = Math.round(((_S-5)*1000+xt)/50);
                      if (morph_H < 10) { morph_H = "0" + morph_H; }
                   }
                 }
    else if (M_ == 0) { M_ = M_ + "1"; }
    else { M_ = M_ * 10 + (M_ + 1); }
    
    // minutes part 2
    if (_M == 9) { _M = _M + "0";
                   if (S_ == 5 && _S >= 5) {
                      morphM_ = Math.round(((_S-5)*1000+xt)/50);
                      if (morphM_ < 10) { morphM_ = "0" + morphM_; }
                   }
                 }
    else if (_M == 0) { _M = _M + "1"; }
    else { _M = _M * 10 + (_M + 1); } 
    
    // seconds (implicit)
    if (S_ == 5 && _S >= 5) { 
       morph_M = Math.round(((_S-5)*1000+xt)/50);
       if (morph_M < 10) { morph_M = "0" + morph_M; }
    }
    var morphC_ = Math.round(xt/10);
    if (morphC_ < 10) { morphC_ = "0" + morphC_; }
    
    // apply changes to images
    img_slot['digit-hhmm12-Hx'].src="svg/md-" + H_ + "-" + morphH_ + ".svg";
    img_slot['digit-hhmm12-xH'].src="svg/md-" + _H + "-" + morph_H + ".svg";
    
    img_slot['colon-hhmm12-Cx'].src="svg/md-" + C_ + "-" + morphC_ + ".svg";
    
    img_slot['digit-hhmm12-Mx'].src="svg/md-" + M_ + "-" + morphM_ + ".svg";
    img_slot['digit-hhmm12-xM'].src="svg/md-" + _M + "-" + morph_M + ".svg";
    
    img_slot['alpha-hhmm12-Dx'].src="svg/md-" + D_ + "-" + morphD_ + ".svg";
    img_slot['alpha-hhmm12-xD'].src="svg/md-" + _D + "-" + morph_D + ".svg";
}

</script>

<div id="morphclock" data-format="hhmm12"></div>
</body>
</html>
